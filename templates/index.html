<!--
sudo service apache2 restart
-->

<link rel="shortcut icon" href="static/icon_blue.png">

<head>
    <title>Fandom Map</title>
    <script src="https://apis.google.com/js/api:client.js"></script>

    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id"
        content="507651740228-f5clg8q3qlf66se0e40m5p2hthr4djtb.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/3.1.2/fullpage.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/3.1.2/fullpage.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>

</head>

<style>
    html,
    body {
        font-family: Arial;
        padding: 0;
        margin: 0;
        height: 100%;
    }

    h1 {
        font-weight: bold;
        font-size: 80px;
    }

    .section,
    .middle {
        align-items: center;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
        margin: auto;
        padding: 5%;
        padding-left: 20%;
        padding-right: 20%;

    }

    .sidebarbtn {
        float: left;
        z-index: 5;
        position: fixed;
    }

    #sidebar,
    #userbar {
        float: left;
        height: 100%;
        position: fixed;
        z-index: 5;
        width: 25%;
        background-image: linear-gradient(to right, black, rgba(0, 0, 0, 0.05));
        padding-top: 100px;
        color: white;
    }

    #userbar {
        overflow-y: scroll;
overflow-x: hidden;
float: left;
height: 100%;
position: fixed;
z-index: 5;
width: 25%;
color: white;
right:0;
background-image:linear-gradient(to left,black,rgba(0, 0, 0, 0.05 ));
align-items: center;
text-align: center;
overflow-y: auto;
    }
    #sidebarclose{
text-align: right;
    }
    #sidebarbox>div,#signin2,
    #sidebarclose {
        z-index: 10;
        margin: 5%;
        cursor: pointer;
        padding: 5%;
        
    }

    #sidebarbox>div:hover,
    #sidebarclose:hover {
        background-color: #0080ff
    }

    .sidebarbutton,
    .userbutton {
        position: fixed;
        height: 60px;
        width: 60px;
        border-radius: 5px;
        display: block;
        background: #0080ff;
        z-index: 9;
        text-align: center;
        color: white;
        padding: 10px 15px 10px;
    }

    .important {
        cursor: pointer;
        height: 60px;
        border-radius: 5px;
        display: block;
        background: #0080ff;
        text-align: center;
        color: white;
        padding: 10px 15px 10px;
        border: none;
        margin: 5%;
        align-items: center;
        margin-left: auto;
        margin-right: auto;
    }

    .userbutton,
    #signin {
        right: 0
    }
    #fadein {
        position: absolute;
        top: 20%;
        display: block;
        left: 0;
        right: 0;
        margin-left: auto;
        margin-right: auto;
        display: none;
        color: white
    }

    #signout {
        display: none
    }

    #bk {
        height: 100%;
        background-image: url("/static/slideshow.gif");
        backdrop-filter: blur(5px);
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-size: cover;
        background-position: center;
        filter: blur(5px) saturate(30%);
    }

    #popupbox {
        background-color: black;
        margin-left: auto;
        margin-right: auto;
        display: block;
        width: 80%;
        bottom: 0px;
        position: fixed;
        z-index: 9;
        left: 0;
        right: 0;
        position: fixed;
        height: 60px;
        border-radius: 5px;
        background: #0080ff;
        z-index: 9;
        text-align: center;
        color: white;
        padding: 20px;
        bottom: 0;
        margin-left: auto;
        margin-right: auto;
        display: block;
        width: 80%;
        display: none;
    }

    #popupbox>button {
        float: right;
        background-color: #ffffff00;
        border: none;
        cursor: pointer;
        color: white;
    }

    #About>img,
    #About>a>img {
        height: 40;
        display: inline-block;
    }

    .icon {
        height: 50;
        display: inline-block;
    }

    h2 {
        display: inline-block;
    }

    .section {
        width: 100%;
        display: block;
        width: 100vm;
        min-height: 20%;
    }

    input {
        width: 50%;
        outline: 0;
        border-width: 0 0 2px;
        border-color: #0080ff;
        background-color: rgba(0, 0, 0, 0.1);
    }

    #exploreresult>div {
        border-radius: 5px;
        border: 2px #0080ff;
        border-style: solid;
        background-color: rgb(0, 128, 255, 0.5);
        cursor: pointer;
        width: 43%;
        margin: 3%;
        display: inline-block;
    }

    #exploreresult>div>img {
        width: 100%;
    }
    .g{
        height: 100%;
        height:40;
    }
    .section:nth-child(odd) {
        background-color: #96D4D4;
    }

    td {
        width: 45%;
        font-weight: bold;
        font-size: 30px;
        height: 30%;
        width: 50%;
        padding: 3%;
        cursor: pointer;
        text-align: center;

    }

    #FAQ>p {
        color: black;
        font-weight: bold;
        display: block;
        margin: 0;
        padding: 0;
        margin-top: 3%;

    }

    #Welcome {
        padding: 0;

    }

    #exploreresult>div>p,
    #exploreresult>div>a {
        display: inline-block;
        margin: 0;
        padding: 0;
        padding-left: 2%;
        padding-right: 2%;

    }

    #exploreresult>div>a {
        color: grey
    }

    #exploreresult>div>p {
        font-weight: bold
    }

    table {
        width: 100%;
    }
    #explore{
        padding-left: 5%;
        padding-right: 5%;
    }
    td:hover,#exploreresult>div:hover,#signin2:hover{
        background-color: #3399ff;
        cursor: pointer;
    }

    #signin{
        width: 100%;
    }
    #create{
        display: none;
    }
    #sidebarclose{
        text-align: left;
    }
    #signin0{
        display: none;
    }
    #userbarclose{
        text-align: right;
    }
</style>

<button class="w3-button w3-xlarge sidebarbutton" onclick="sidebarbtn()">☰</button>
<button class="w3-button w3-xlarge userbutton" onclick="userbarbtn()"><img src="static/user.png" height="50%"></button>
<div id='popupbox'><a id=popupmsg>Message</a><button onclick='popupbtn()'>X</button></div>
<div class="sidebar" style="display:none" id="sidebar">
    <div id='sidebarclose' onclick="sidebarbtn()">Close X</div>
    <div id='sidebarbox'></div>
</div>
<!--sidebar-->
<div style="display:none" id="userbar">
    <div id='sidebarclose' onclick="userbarbtn()">Close X</div>
    <div id=signin2><img class=g src=static/goo.png>Google Sign In</div>
    <div id='signin0'class="g-signin2"data-onsuccess="onSignIn"data-theme="dark"></div>
    <button id='signout' onclick="signOut()">Sign out</button>
    <div id='profile'></div>
</div>
<!--userbar-->
<div id="fullpage">
    <div id="Welcome" class="section" data-anchor='$Welcome'>
        <h2 style="display:none">Welcome</h2>
        <div id='bk'></div>
        <div id='fadein'>
            <img src="/static/icon_wht.png">
            <h1>Fandom Map</h1>
            Public Interactive Map for Fandom Wikipedia
        </div>
        <!--fadein-->

    </div>
    <!--welcome-->
</div>
<!--fullpage-->

<div id="Redirect" class="section fp-auto-height" data-anchor='$Redirect'>
    <table>
        <td id='createtd'>
            <h3>Sign in by Google Account to create your own map</h3>
            <button class='important' id='signin'><img class=g src=static/goo.png>SIGN IN</button>

            <button class='important' id='create'>CREATE</button>
        </td>
        <td id=exploretd>
            <h3>Explore Public Maps</h3>
            <button class='important' id='explorebtn'>EXPLORE</button>
        </td>
        <h2 style="display:none">Redirect</h2>

    </table>
</div>
<div id="About" class="section">
    <img class=icon src=static/wp.png>
    <h2>About</h2><br>
    Fandom Map is an open sourced website made for a univsersity final year project, using Amazon AWS cloud to host
    community based serving website.
    Please contact me on discord Zachary#6611 or fill <a href=https://forms.gle/jJarQ8e6vK9y839f7>this questionnaire</a>
    for any issues and needs. Thank you
    <br><a href=https://forms.gle/jJarQ8e6vK9y839f7><img class=g src=static/goo.png> Google Form Support Ticket / Bug Report / Suggestion Form</a>
    <br><a href=http://github.com/fandommap/fandommap.github.io><img src=static/git.png> Github Repository</a>
    <br><img src=static/dis.png> Discord Zachary#6611
</div>
<!--about-->
<div id=T&S class=Section>
    <img class=icon src=static/wp.png>
    <h2>Terms and Service</h2>
    <br>
    We are committed to providing a friendly, safe and welcome environment for all fandom communities,
    regardless of gender identity and expression. The below terms established what you can expect from our website
    services.
    And what we expect from you:
    <br>
    • Using website resources resonably.
    <br>
    • Collaborate with other community fandom members, gracefully accept criticism against your map.
    <br>
    • Being respectful of others viewpoints and experience to not creating offensive materials.
</div>
<!--COC-->
<div id="FAQ" class="section">
    <img class=icon src=static/wp.png>
    <h2>FAQ Frequently Asked Questions</h2><br>
    <p>What is Fandom Map and how does it work?</p>
    Fandom user are free to create their maps. By adding map image and add waypoints on the map, using the map link to
    share it your other favourite communties out there!
    <p>Why should I use Fandom Map?</p>
    Fandom Map isn't just a place to share map images online, but also share the information on a 2-dimension scale!
    <p>Is Fandom Map Under Fandom wiki platform?</p>
    No, fandom is a common word to decribe a fanbase of a fictional series.
    <p>Who is Fandom Map for?</p>
    You! And for the fandom communties love their fictional serires and willing to produce top-notch map.
    <p>Is Fandom Map free?</p>
    All the reasources are free, unlimited access to public avaliable maps with unlimited map creation power!
    <p>I have issues, bugs or other questions!</p>
    Please contact on discord Zachary#6611 or by filling <a
    href=https://forms.gle/jJarQ8e6vK9y839f7>this questionnaire</a>.
</div>
<!--faq-->

<div id="Explore" class="section  fp-auto-height" data-anchor='$Explore'>
    <img class=icon src=static/wp.png>
    <h2>Explore</h2><br>
    <input placeholder='Search Map Names...'></input>
    <div id=exploreresult></div>
</div>
<!--explore-->
<script>
    if ('{{popup}}') { popup('{{popup}}') }
    var name, email
    new fullpage('#fullpage', {
        sectionsColor: ['white', 'white', 'white', 'white', 'white'],
        autoScrolling: false,
        fitToSection: false,
        verticalCentered: true,
        normalScrollElements: '.w3-sidebar,.sidebarbtn'
    });
    $(document).ready(function () {
        let sidebarlist = ['Welcome', 'Redirect', 'About', 'Terms and Service', 'FAQ', 'Explore']
        for (let i = 0; i < sidebarlist.length; i++) {
            $('#sidebarbox').append('<div>' + sidebarlist[i] + '</div>')
        }
        $('#fadein').delay(300).fadeIn(800);
    })//ready
    function signOut() {
        $('#my-signin2,#signin2,#signin').show()
        $('#signout,#create').hide()
        gapi.auth2.getAuthInstance().signOut()
        $('#profile').html('')
    }
    function onSignIn(googleUser){
        $('#my-signin2,#signin2,#signin').hide()
        $('#signout,#create').show()
var profile=googleUser.getBasicProfile();
console.log('Full Name: '+profile.getName());
console.log('Email: '+profile.getEmail());
email=profile.getEmail()
name=profile.getName()

$('#profile').html('<div>Name</div><div>'+profile.getName()+'</div><div>Email</div><div>'+profile.getEmail()+'</div>')
}
    function sidebarbtn() { $('#sidebar').toggle("slide") }
    function userbarbtn() { $('#userbar').toggle("slide") }
    function popupbtn() { $('#popupbox').slideToggle() }

    function popup(msg) {
        if ($('#popupbox').is(':visible')) { $('#popupbox').slideToggle() }
        $('#popupmsg').html(msg)
        $('#popupbox').slideToggle().delay(10000).slideToggle()
    }//popup
    $('#createtd').click(function () {
        $.ajax({ data: { email: email, name: name }, type: 'POST', url: '/$create' })
            .done(function (data) { window.location.href = '/' + String(data.result) })
    })
    var elementglobal
    var decodeglobal
    var finishresult = []
    result = decodeHtml('{{result}}').split("行行")
    result.forEach(function (element, index) {
        result[index] = element.split("列列")
    })
    result.pop()
    function decodeHtml(html) {
        var txt = document.createElement("textarea");
        txt.innerHTML = html;
        return txt.value;
    }
    result.forEach(function (element) {
        $.ajax({
            url: 'static/' + element[0] + '_map.png', success: function () {
                adddiv(element, element[0] + '_map.png')
            }, error: function () {
                $.ajax({
                    url: 'static/' + element[0] + '_map.jpg', success: function () {
                        adddiv(element, element[0] + '_map.jpg')
                    }, error: function () {
                        $.ajax({
                            url: 'static/' + element[0] + '_map.jpeg', success: function () {
                                adddiv(element, element[0] + '_map.jpeg')
                            }, error: function () { adddiv(element, false) }
                        })
                    }
                })
            }
        })
    })
    heading = ['Name', 'Author', 'Creation Date']
    function adddiv(element, filename) {
        id = element.shift()
        desc = ''
        element.forEach(function (elementelement, index) {
            desc += '<a>' + heading[index] + '</a><p>' + elementelement + '</p><br>'
        })
        if (filename) { $('#exploreresult').append('<div id=' + id + '><img src=static/' + filename + '>' + desc + '<p><p></div>') }
        else $('#exploreresult').append('<div id=' + id + '>' + desc + '</div>')
    }
    $(document).on("click", "#exploreresult>div", function () {
        window.location.href = '/' + $(this).attr('id')
    })
    $('#explore>input').keyup(function () {
        if ($(this).val() == '') { $('#exploreresult>div').show() }
        list = $('#exploreresult>div');
        for (var i = 0; i < list.length; i++) {
            if (list[i].textContent.toUpperCase().indexOf($(this).val().toUpperCase()) > -1 && list[i].style.display == "") {
                list[i].style.display = ""
            } else { list[i].style.display = "none" }
        }
    })
    $(document).on("click", "#sidebarbox>div", function () {
        $('html,body').animate({ scrollTop: $("h2:contains(" + $(this).text() + ')').offset().top }, 800);
    })
    $('#exploretd').click(function () {
        $('html,body').animate({ scrollTop: $("h2:contains(Explore)").offset().top }, 800);

    })
    var googleUser = {};
var startApp = function() {
gapi.load('auth2', function(){
    auth2 = gapi.auth2.init({
    client_id: '507651740228-f5clg8q3qlf66se0e40m5p2hthr4djtb.apps.googleusercontent.com',
    cookiepolicy: 'single_host_origin',
    });
    attachSignin(document.getElementById('createtd'));
    attachSignin2(document.getElementById('signin2'));
});
};
function attachSignin(element) {
auth2.attachClickHandler(element,{},function(googleUser){
    var profile = googleUser.getBasicProfile();
        email = profile.getEmail()
        name = profile.getName()
        $.ajax({ data: { email: email, name: name }, type: 'POST', url: '/$create' })
            .done(function (data) { window.location.href = '/' + String(data.result) })

});
}
function attachSignin2(element) {
auth2.attachClickHandler(element,{},function(googleUser){
    $('#my-signin2,#signin2,#signin').hide()
        $('#signout,#create').show()
        var profile = googleUser.getBasicProfile();
        email = profile.getEmail()
        name = profile.getName()
        $('#profile').html('<div>Name</div><div>' + profile.getName() + '</div><div>Email</div><div>' + profile.getEmail() + '</div>')
    

});
}
</script>
<script>startApp();</script>
